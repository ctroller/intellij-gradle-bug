rootProject.name = 'intellij-bug'

void addSubProjects(String path, File dir) {
    if (!dir.isDirectory()) return;
    if (dir.name == 'buildSrc') return;
    if (!new File(dir, 'build.gradle').exists()) return;
    if (new File(dir, 'settings.gradle').exists()) return;
    if (findProject(dir) != null) return;

    final String projectName = "${path}:${dir.name}"
    include projectName
    for (File subdir : dir.listFiles()) {
        addSubProjects(projectName, subdir)
    }
}

addSubProjects('', new File(rootProject.projectDir, 'modules'))